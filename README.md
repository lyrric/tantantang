# 探探糖

自动砍价脚本

## 使用方法

- 环境变量配好REDIS_HOST和REDIS_PASSWORD
- token参数抓包，在header头里面。
- key参数在/api/user/thirds接口，只有第一次登陆才会调用。或者点击砍价，请求参数里面的token即为key，同一个账号这个key貌似不会变。

## 待完成

- [x] 运行结束通知
- [ ] 实时查看运行状态
- [ ] 定时运行
- [ ] 监控所有商品
- [ ] 监控单个商品

## 更新记录

- 2025-10-09 自动砍价功能基本能用
    - 优化了砍价逻辑、修改若干BUG、保存砍价进度。
- 2025-10-08 优化了砍价的效率、10个一起执行。
    - 增加了活动列表页面，可以查看所有商品。

## 杂谈

- req_token为加密参数，加密跟请求参数有关系，加密逻辑在rq_token_util.py
- header头的token才是用户会话token
- 砍价接口会额外带一个token也就是key，这个token无效会导致砍价成功，但是得不到糖果，这个token一天内是不会变化的。
- 有时候会砍价示当前砍价人数过多，不清楚是频率太快导致的，还是服务器压力，等待几秒后可以继续（后续测试应该是服务器压力原因，本地两秒一次也会偶现）。
- **一个token最多只能砍400个左右，砍完会自动退出，接口会提示Unauthorized。**
    - 并且这个无法避免，虽然一个用户同时可以存在多个token，但是这个计数是根据用户来统计的，一个用户砍了400个后，会把所有token全部退出登录。
